<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>RCE Recorder</title>
  <link rel="stylesheet" href="https://unpkg.com/rrweb-player@latest/dist/style.css"/>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui; display: flex; flex-direction: column; height: 100vh; background: #1a1a1a; color: #e0e0e0; }
    #toolbar { padding: 1rem; border-bottom: 1px solid #333; background: #2a2a2a; display: flex; align-items: center; justify-content: space-between; }
    #toolbar h2 { margin: 0; color: #fff; font-size: 20px; }
    #status { color: #4CAF50; font-size: 14px; }
    .tabs { display: flex; gap: 0.5rem; }
    .tab { padding: 0.5rem 1rem; background: #1a1a1a; border: 1px solid #333; border-radius: 4px; cursor: pointer; color: #aaa; transition: all 0.2s; }
    .tab:hover { background: #333; color: #fff; }
    .tab.active { background: #4CAF50; color: #fff; border-color: #4CAF50; }
    #main { display: flex; flex: 1; overflow: hidden; position: relative; }
    .view-panel { 
      flex: 1; 
      display: flex; 
      flex-direction: column; 
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 1;
      visibility: visible;
      transition: opacity 0.2s ease-in-out;
    }
    .view-panel.hidden { 
      display: none !important; 
      opacity: 0;
      visibility: hidden;
      pointer-events: none;
    }
    
    /* Live View */
    #live-view { display: flex; width: 100%; height: 100%; }
    #live-left { flex: 2; display: flex; flex-direction: column; border-right: 1px solid #333; min-width: 0; }
    #screencast-container { flex: 1; background: #000; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; min-height: 0; }
    #screencast { max-width: 100%; max-height: 100%; object-fit: contain; }
    #live-right { flex: 1; display: flex; flex-direction: column; background: #1a1a1a; min-width: 0; overflow: hidden; }
    #logs { flex: 1; overflow-y: auto; padding: 1rem; font-family: monospace; font-size: 12px; min-height: 0; }
    #logs h3 { margin: 0 0 1rem 0; color: #fff; font-size: 16px; }
    .log-entry { padding: 4px 8px; margin: 2px 0; border-left: 3px solid #666; background: #222; border-radius: 2px; }
    .log-console { border-left-color: #2196F3; }
    .log-network { border-left-color: #4CAF50; }
    .log-error { border-left-color: #f44336; background: #2a1a1a; }
    .log-time { color: #888; font-size: 10px; }
    
    /* Replay View */
    #replay-view { display: flex; flex-direction: column; padding: 1rem; gap: 1rem; width: 100%; height: 100%; }
    #replay-header { flex-shrink: 0; }
    #replay-header h3 { margin: 0 0 0.5rem 0; color: #fff; }
    #replay-controls { display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; }
    #replay-controls button { padding: 0.5rem 1rem; background: #333; border: 1px solid #555; color: #fff; border-radius: 4px; cursor: pointer; font-size: 14px; }
    #replay-controls button:hover:not(:disabled) { background: #444; }
    #replay-controls button:disabled { opacity: 0.5; cursor: not-allowed; }
    #replay-container { flex: 1; background: #000; border: 1px solid #333; border-radius: 4px; overflow: hidden; position: relative; min-height: 0; display: flex; align-items: center; justify-content: center; }
    #replay-status { padding: 2rem; color: #888; text-align: center; font-size: 14px; }
    #replay-wrapper { width: 100%; height: 100%; }
    
    /* rrweb-player styling overrides */
    #replay-wrapper { 
      display: flex !important; 
      flex-direction: column !important; 
      width: 100% !important; 
      height: 100% !important; 
    }
    .rr-player { 
      width: 100% !important; 
      height: 100% !important; 
      background: #000; 
      display: flex !important; 
      flex-direction: column !important; 
      position: relative !important;
    }
    .rr-player__frame { 
      background: #000 !important; 
      flex: 1 !important; 
      min-height: 0 !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      overflow: hidden !important;
      position: relative !important;
    }
    /* Style the actual replayer wrapper created by rrweb */
    .replayer-wrapper {
      position: relative !important;
      left: 0 !important;
      top: 0 !important;
      transform: none !important;
      margin: 0 auto !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
    }
    .replayer-wrapper > iframe,
    .replayer-wrapper > canvas {
      display: block !important;
    }
    .rr-controller { 
      background: #2a2a2a !important; 
      border-top: 1px solid #333 !important; 
      flex-shrink: 0 !important; 
      position: relative !important;
      z-index: 10 !important;
    }
  </style>
</head>
<body>
  <div id="toolbar">
    <h2>RCE Recorder</h2>
    <div class="tabs">
      <div class="tab active" data-view="live">ðŸ“¡ Live View</div>
      <div class="tab" data-view="replay">ðŸŽ¬ Replay Recording</div>
    </div>
    <span id="status">Connecting...</span>
  </div>
  <div id="main">
    <!-- Live View Panel -->
    <div id="live-view" class="view-panel">
      <div id="live-left">
        <div id="screencast-container">
          <canvas id="screencast"></canvas>
        </div>
      </div>
      <div id="live-right">
        <div id="logs">
          <h3>Console & Network Events</h3>
          <div id="log-entries">Loading logs...</div>
        </div>
      </div>
    </div>
    
    <!-- Replay View Panel -->
    <div id="replay-view" class="view-panel hidden">
      <div id="replay-header">
        <h3>Session Replay - Watch the entire rrweb recording</h3>
        <div id="replay-controls">
          <button id="replay-refresh">ðŸ”„ Refresh Events</button>
          <span id="replay-info" style="color: #888; margin-left: 1rem;"></span>
        </div>
        <p style="margin: 0.5rem 0 0 0; color: #888; font-size: 14px;">Use the playback controls at the bottom of the player to play, pause, and scrub through the recording.</p>
      </div>
      <div id="replay-container">
        <div id="replay-status">Click "Refresh Events" to load the recording...</div>
      </div>
    </div>
  </div>
  <script src="https://unpkg.com/rrweb@latest/dist/rrweb.min.js"></script>
  <script src="https://unpkg.com/rrweb-player@latest/dist/index.js"></script>
  <script src="/app.js"></script>
</body>
</html>
